#!/usr/bin/env node
"use strict";

const { execFileSync } = require("child_process");
const path = require("path");

const PLATFORMS = {
  "linux-x64": "authy-linux-x64",
  "linux-arm64": "authy-linux-arm64",
  "darwin-x64": "authy-darwin-x64",
  "darwin-arm64": "authy-darwin-arm64",
  "win32-x64": "authy-win32-x64.exe",
};

const key = `${process.platform}-${process.arch}`;
const binary = PLATFORMS[key];

if (!binary) {
  console.error(`Unsupported platform: ${key}`);
  console.error(`Supported: ${Object.keys(PLATFORMS).join(", ")}`);
  process.exit(1);
}

const binPath = path.join(__dirname, binary);

try {
  execFileSync(binPath, process.argv.slice(2), { stdio: "inherit" });
} catch (err) {
  if (err.status !== null) {
    process.exit(err.status);
  }
  throw err;
}
